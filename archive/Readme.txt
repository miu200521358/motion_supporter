----------------------------------------------------------------
----------------------------------------------------------------

　「モーションサポーター」

　　ver1.03

　　　　　　　　　　　　　　　　　miu200521358

----------------------------------------------------------------
----------------------------------------------------------------


　この度は拙作をDLしていただき、ありがとうございます。
　お手数ですが以下をご確認のうえ、ご利用ください。

----------------------------------------------------------------


----------------------------------------------------------------
■　概要
----------------------------------------------------------------

　モーションの作成や調整に役立つかもしれない小ネタツールです


----------------------------------------------------------------
■　配布動画
----------------------------------------------------------------

■　配布動画

　モーションサポーターを作ってみた【ver1.00】
　https://www.nicovideo.jp/watch/sm37848683

■　コンテンツツリー用静画

　https://seiga.nicovideo.jp/seiga/im10581987


----------------------------------------------------------------
■　同梱ファイル
----------------------------------------------------------------

　・MotionSupporter_1.02_64bit.exe　　…　ツール本体
　・Readme.txt　　　　　　　　　　　　…　リドミ
　・コンテンツツリー用静画　　　　　　…　コンテンツツリー用静画へのリンク


----------------------------------------------------------------
■　動作環境
----------------------------------------------------------------

　Windows8.1/10 64bit（確認はWindows10のみ）


----------------------------------------------------------------
■　起動
----------------------------------------------------------------

・基本的にはexeをそのまま起動していただければ大丈夫です。

・ハイスペック版は、内部で並列処理を行うので、通常版の1.3倍くらい速く処理が行われます。
　ただし、その分負荷も大きくなるので、PCの性能が大丈夫って方だけの方がよさげです。

・ログあり版は、VMDサイジングv4の頃のように、出力VMDファイルパスと同じところにログファイルを出力します。

・ファイル履歴は、「history.json」をexeと同じフォルダに配置する事でコピー可能です。


----------------------------------------------------------------
■　機能概要
----------------------------------------------------------------

1) 全親移植

「全ての親」に登録されたキーフレの値を、
「センター（移動・回転）」・「上半身（回転）」・「下半身（回転）」・「足ＩＫ（移動）」に移植して、
「全ての親」の値をクリアします。

これにより、全ての親による移動がなくなり、再配置がしやすくなります
。
また、「センターの回転を上半身/下半身に移植する」フラグにチェックを入れると、
センターの回転が、上半身と下半身の回転に移植されます。
センター回転を体幹回転に置き換えたい場合に使ってください。


----------------
2) ゆらぎ複製

キーフレの値と補間曲線をゆらぎの大きさに応じてズラしたモーションを再作成します。
移動量は、値が0の場合はゆらぎを付与しません。
回転量は、値が0であってもゆらぎを付与します。
指は、ゆらがせるかどうかを選択できます。
出力ファイル名の、Nxxは指定ゆらぎの大きさ、nxxxは複製連番、axxxはやる気係数（体の振りの大きさ：ランダム）です。

これにより、（特に並べた時の）モーションの機械っぽさが減ります。
キーフレの位置は移動させないので、元モーションのキーフレを上書きすることで、
任意の場所だけピタッと合わせる事も可能です。


----------------
3) 多段分割

指定ボーンのキーフレを、移動量と回転量のXYZにそれぞれ分割します。
分割するボーンは「ボーン指定」ボタンから定義出来ます。
回転ボーンは、PMXEditorで追加する際に、YXZの順番で多段化すると、回転結果がオリジナルと一致します。

ボーン指定ダイアログでは、ボーン名を入力すると、自動的に回転や移動にも推奨多段ボーン名もしくは同じボーン名が候補として入ります。
その上で、必要なボーンを指定して下さい。

これにより、多段ボーンでのモーション作成が可能となります。

センターとグルーブのように、位置が若干違うボーンを統合分割した場合、回転が含まれていると想定外の動きになる可能性があります。
分割対象に指定されなかった軸の値は捨てられます。

----------------
4) 多段統合

指定多段ボーンのキーフレの移動量XYZと回転量XYZをすべて統合します。
統合するボーンは「ボーン指定」ボタンから定義出来ます。（多段分割の設定エクスポートファイルから流用が可能です）

ボーン指定ダイアログでは、ボーン名を入力すると、自動的に回転や移動にも推奨多段ボーン名もしくは同じボーン名が候補として入ります。
その上で、必要なボーンを指定して下さい。

これにより、多段ボーンで作成したモーションを、準標準ボーン等で配布する事ができます。

センターとグルーブのように、位置が若干違うボーンを統合分割した場合、回転が含まれていると想定外の動きになる可能性があります。
統合対象ボーンはXYZと書いてますが、特に軸の制限はありません。
回転のローカル軸合成順番がYXZとなるので、その順番で多段化されたボーンであれば統合可能です。

【参考】
【MMD】多段ボーンモーションを準標準ボーン用に統合する方法
https://ch.nicovideo.jp/HOPHEAD/blomaga/ar805999


----------------
5) 足FKtoIK

足FK（足・ひざ・足首）を、足IK（足ＩＫの位置と角度）に変換します。
IKonoffもIKonに変換されます。
FKは残してありますので、IKoffにしても同じ動きにできます。
モーションキャプチャー等で作成された足FKモーションを足IKモーションに変換するのを主に想定しています。


----------------
6) スムージング

・指定されたモーションのキーフレを、滑らかに繋いだ形で新たに軌跡を作り、VMDを出力します。
・キーフレ間の補間方法は、三種類から選べます。
　・補間曲線に従う　…　キーフレに登録されている補間曲線に従って補間します。キーの全打ちと同等です。
　・補間曲線を無視（円形）　…　補間曲線を無視して、三点を繋いだ球になる形で軌跡を作ります。スケートモーションとかにも使えるかもしれません。
　・補間曲線を無視（曲線）　…　補間曲線を無視して、キーフレをカトマル曲線で繋いだ軌跡を作ります。おそらく一番汎用性が高いです。
・適用したいモデルの指定が必要です。人体でも無機質でも何でも対応可能です。
・スムージング回数が増えるに従って、軌跡が小さく緩く遅くなっていきます。
　1回だけだと全打ち。2回で最低限のキー間引き。それ以降は指定回数分間引きします。
・ver1.01より、モーフスムージングも出来るようになりました。
・ver1.02より、スムージング時のフィルタ処理を2回目冒頭のみに限定するようにしました。

----------------
7) モーフブレンド

・指定されたモデルの、指定されたモーフをランダムに組み合わせたモーションデータを作成します。
・組み合わせる数が多くなると破綻確率が上がるので注意してください。
・破綻状態での一般公開は避けてください。


----------------
8) 補間曲線ビューワー

・MMDの補間曲線を分割したらどうなるかを図で表示します。



----------------------------------------------------------------
■　使用条件 他
----------------------------------------------------------------

　《必須事項》

　　・変換したVMDモーションの結果を公開・配布する場合は、クレジットの明記のご協力をお願い致します
　　・ニコニコ動画の場合、コンテンツツリーへツリー用静画(im10581987)を登録してください
　　　※コンテンツツリーに親登録していただける場合、クレジット記載は任意です


　《任意事項》

　　本ツールおよび生成したモーションに関して、元々のモーションの規約の範囲内で、以下の行為は自由に行って下さい

　　・モーションの調整・改変
　　・動画投稿サイト、SNS等へのモーション使用動画投稿
　　　・進捗等で生成したモーションそのままを投稿することも問題ありません
　　　・ただし、元々のモーションやモデルの規約で投稿先が制限されている場合、このツールで生成したモーションもそれに準じます

　《禁止事項》

　　本ツールおよび生成したモーションに関して、以下の行為はご遠慮願います

　　・元々のモーションやモデル等の規約範囲外の行為
　　・モーションの完全自作発言
　　・各権利者様のご迷惑になるような行為
　　・他者の誹謗中傷目的の利用（二次元・三次元不問）

　《免責事項》

　　・元モーションから動きが変わる場合がありますので、自己責任でご利用ください
　　・ツール使用によって生じたいかなる問題に関して、作者は一切の責任を負いかねます


----------------------------------------------------------------
■　ソースコード・ライブラリ
----------------------------------------------------------------

このツールは、pythonで作成しており、以下ライブラリを使用・同梱しています。

・numpy (https://pypi.org/project/numpy/)
・bezier (https://pypi.org/project/bezier/)
・numpy-quaternion (https://pypi.org/project/numpy-quaternion/)
・wxPython (https://pypi.org/project/wxPython/)
・pyinstaller (https://pypi.org/project/PyInstaller/)

ソースコードは、Githubで公開しています。(MITライセンス)

https://github.com/miu200521358/motion_supporter

----------------------------------------------------------------
■　クレジット
----------------------------------------------------------------

　ツール名：　モーションサポーター もしくは MotionSupporter
　作者：　miu もしくは miu200521358

　http://www.nicovideo.jp/user/2776342
　Twitter: @miu200521358
　Mail: garnet200521358@gmail.com


----------------------------------------------------------------
■　履歴
----------------------------------------------------------------

ver1.03（2021/08/17）
　・腕IKtoFK
　　　・「両用腕ＩＫ（ＦＫＩＫ）：P.I.Pさん作」を腕FKに変換する処理
　　　・他の腕IKには対応してません
　・足FKtoIK
　　　・足首水平化オプション追加
　　　　・足首が水平に近い場合、足首を地面に水平にして接地させるオプション
　　　・つま先・かかとY=0オプション追加
　　　　・つま先もしくはかかとの最もY位置が低い箇所をY=0として設定するオプション
　　　　・ジャンプも接地させるのでジャンプに失敗します（改修予定）
　・スムージング
　　・間引き処理を見直し
　・エラーログメッセージを修正
　・多段分割・多段統合の画面インデックス名を123からXYZに戻した

　　・スムージングのロジックを修正
　　　・フィルタ処理を2回目冒頭のみに限定
　　・多段分割、統合の指定ダイアログのヘッダ文言変更

ver1.02（2021/01/24）
　　・スムージングのロジックを修正
　　　・フィルタ処理を2回目冒頭のみに限定
　　・多段分割、統合の指定ダイアログのヘッダ文言変更

ver1.01（2020/12/20）
　　・モーフスムージング機能追加


ver1.00（2020/11/21）
　　・正式配布開始
　　・全親移植、ゆらぎ複製、多段分割、多段統合、足FKtoIK　…　新規作成
　　・スムージング、モーフブレンド、補間ビューワー　…　サイジングより移植


ver1.00_β04　（2020/08/15）

　　・β版配布開始




